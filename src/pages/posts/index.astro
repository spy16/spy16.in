---
import { getCollection } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import { isBefore } from "date-fns";

const posts = (await getCollection("blog"))
	.filter((p) => {
		if (import.meta.env.PROD) return !!p.data.publish;
		return true;
	})
	.sort((a, b) => (isBefore(a.data.pubDate, b.data.pubDate) ? 1 : -1));
---

<Layout title="Blog Posts">
	<main>
		<ul
			class="flex flex-col gap-6 items-center w-full max-w-screen-md mx-auto px-2"
		>
			{
				posts.map((b) => (
					<li class="w-full flex flex-row gap-4 items-center">
						<div class="flex flex-col gap-1 items-center p-4 border rounded-md bg-white">
							<span class="text-3xl font-extrabold">
								{b.data.pubDate.getDate()}
							</span>
							<span class="text-sm">
								{b.data.pubDate.toLocaleString("default", {
									year: "numeric",
									month: "short",
								})}
							</span>
						</div>

						<div class="flex flex-1 flex-col gap-2 justify-center">
							<div class="flex flex-row gap-1 flex-wrap">
								<a
									href={`/posts/${b.slug}`}
									class="text-xl font-bold link no-underline hover:underline w-fit"
								>
									{b.data.title}
								</a>
								{!b.data.publish && (
									<span class="badge badge-sm badge-neutral">
										DRAFT
									</span>
								)}
							</div>

							<p>{b.data.description}</p>
						</div>
					</li>
				))
			}
		</ul>
	</main>
</Layout>
